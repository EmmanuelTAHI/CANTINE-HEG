{% extends 'cantine_web/base.html' %}
{% load static %}

{% block title %}Détail des plats servis - Gestion Cantine HEG{% endblock %}

{% block content %}
<!-- Header -->
<div class="bg-gradient-to-r from-primary/10 via-white to-primary/10 py-12 mb-8">
    <div class="container mx-auto px-4">
        <h1 class="text-5xl font-heading font-bold mb-2 text-neutral">
            Détail des plats servis
        </h1>
        <p class="text-lg text-neutral/70">Consultation des plats servis par élève, par période</p>
    </div>
</div>

<!-- Filtres -->
<div class="container mx-auto px-4 mb-8">
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6">
        <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <select name="eleve" class="select select-bordered w-full bg-white border-gray-300 focus:border-primary focus:outline-none">
                <option value="">Tous les élèves</option>
                {% for eleve in eleves %}
                <option value="{{ eleve.id }}" {% if eleve_selected == eleve.id %}selected{% endif %}>{{ eleve }}</option>
                {% endfor %}
            </select>
            <input type="date" name="date_debut" value="{{ date_debut }}" placeholder="Date de début" class="input input-bordered w-full bg-white border-gray-300 focus:border-primary focus:outline-none">
            <input type="date" name="date_fin" value="{{ date_fin }}" placeholder="Date de fin" class="input input-bordered w-full bg-white border-gray-300 focus:border-primary focus:outline-none">
            <button type="submit" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                <i class="fas fa-search mr-2"></i>Filtrer
            </button>
        </form>
    </div>
</div>

<!-- Statistiques -->
{% if repas %}
<div class="container mx-auto px-4 mb-8">
    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h3 class="text-lg font-semibold text-neutral mb-1">Total repas trouvés</h3>
                <p class="text-3xl font-bold text-primary">{{ repas|length }}</p>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-neutral mb-1">Élèves concernés</h3>
                <p class="text-3xl font-bold text-primary">
                    {% if eleve_selected %}
                    1
                    {% else %}
                    {{ repas|length|add:"0"|add:"0"|default:repas|length }}
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Liste des repas -->
<div class="container mx-auto px-4 mb-8">
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
            <table class="table w-full">
                <thead>
                    <tr class="border-b-2 border-gray-200 bg-gray-50">
                        <th class="text-neutral/70 font-semibold">Date</th>
                        <th class="text-neutral/70 font-semibold">Élève</th>
                        <th class="text-neutral/70 font-semibold">Classe</th>
                        <th class="text-neutral/70 font-semibold">Plat principal</th>
                        <th class="text-neutral/70 font-semibold">Accompagnement</th>
                        <th class="text-neutral/70 font-semibold">Dessert</th>
                    </tr>
                </thead>
                <tbody>
                    {% for repas_obj in repas %}
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="text-neutral">{{ repas_obj.date|date:"d/m/Y" }}</td>
                        <td>
                            <div class="flex items-center gap-2">
                                {% if repas_obj.eleve.photo %}
                                <div class="avatar">
                                    <div class="w-8 rounded-full ring-2 ring-primary/20">
                                        <img src="{{ repas_obj.eleve.photo.url }}" alt="{{ repas_obj.eleve }}">
                                    </div>
                                </div>
                                {% endif %}
                                <span class="font-semibold text-neutral">{{ repas_obj.eleve.prenom }} {{ repas_obj.eleve.nom }}</span>
                            </div>
                        </td>
                        <td class="text-neutral/70">{{ repas_obj.eleve.classe|default:"—" }}</td>
                        <td class="text-neutral">{{ repas_obj.menu.plat_principal|default:"—" }}</td>
                        <td class="text-neutral/70">{{ repas_obj.menu.accompagnement|default:"—" }}</td>
                        <td class="text-neutral/70">{{ repas_obj.menu.dessert|default:"—" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-neutral/60 py-12">Aucun repas trouvé pour les critères sélectionnés</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
